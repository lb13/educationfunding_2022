<!DOCTYPE html>
<html lang="en">
    <head>
	<meta name="generator" content="Hugo 0.92.2" />
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>
            Education Funding UK (beta)
        </title>
        <link rel="stylesheet" href="/css/bulma.css">
    </head>

  <body>
      <navbar><a href="/">Home</a>| <a href="/posts/">Posts</a>| <a href="/resources/">Resources</a></navbar>
    

    <div class="container" style="outline: 0px solid red;">
        <div style="padding: 20px">
            <h1 class="is-size-1">Education Funding v2 (beta)</h1>

            <div class="notification my-4">
              This is going to look a bit different when it's finished...
            </div>

            <style>
                .elbi-results {
                    width: 100%;
                }
                .elbi-results-item {
                    background-color: #FFFFFF;
                    color: #000000;
                    padding: 10px;
                    border: 1px solid black;
                }
            </style>
            
            <div>
                <input type="search" class="input is-size-4" id="elbi-input" placeholder="Search the site..." autofocus />
                <ul id="elbi-results"></ul>
            </div>
            
            <script>
                const input = document.getElementById("elbi-input");
                const results = document.getElementById("elbi-results");
                const request = new Request("/index.json");
                const display_score = false; 
            
                fetch(request)
                    .then(response => response.json())
                    .then(data => {
                        let pages = data;
            
                        input.addEventListener("input",function(){
                            let filteredPages = pages;
                            results.innerHTML = "";
            
                            
                            if (input.value != ""){
            
                                
                                filteredPages.forEach(function(page) {
                                    page.score = 0;
                                });
            
                                
                                
                                let searchterms = input.value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().split(" ");
            
                                
                                searchterms.forEach(function(term) {
                                    if (term != "") {
                                        filteredPages = filteredPages.filter(function(page) {
                                            
                                            
                                            
                                            
                                            
                                            let description = JSON.stringify(page);
                                            return description.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().indexOf(term) !== -1;
                                        });
                                    }
                                }); 
            
                                
                                searchterms.forEach(function(term) {
                                    if (term != "") {
                                        
                                        filteredPages.forEach(function(page) {
            
                                            
                                            if (page.title.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                                page.score += 3
                                            };
            
                                            
                                            if (JSON.stringify(page.tags).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                                page.score += 2
                                            };
            
                                            
                                            if (page.description.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                                page.score += 1
                                            };
            
                                            
                                            if (JSON.stringify(page.categories).normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().includes(term)) {
                                                page.score += 1
                                            };
                                        })
                                    };                                      
                                });
            
                                
                                filteredPages = filteredPages.filter(function(page){
                                    return page.score > 0;
                                })
            
                                
                                
                                filteredPages.sort(function(a, b) {
                                    const titleA = a.title.toUpperCase(); 
                                    const titleB = b.title.toUpperCase(); 
                                    if (titleA < titleB) {
                                        return -1;
                                    }
                                    if (titleA > titleB) {
                                        return 1;
                                    }
                                    
                                    return 0;
                                });
                                
                                
                                filteredPages.sort(function(a, b) {
                                    return b.score - a.score;
                                });
            
                                
                                filteredPages.forEach(function(page) {
                                    let tagsHTML = '';

                                    page.tags.forEach(function(tag){
                                        tagsHTML += "<a href=\"/tags/" + tag.replace(' ','-') + "\" class=\"tag mr-2\">" + tag + "</a>";
                                    })
                                    
                                    let resultHTML = "<li class='elbi-results-item'><span style=\"display: inline-block; background-color: #FFC300; color: #403100; border: 1px solid #403100; padding: 5px; margin-top: 5px; margin-bottom: 10px; border-radius: 5px\">" + page.section + "</span><h2 style='font-size: 1.5rem; font-weight: 800;'>" + page.title + "</h2><p>" + page.description + "</p><a class=\"button my-2 mr-2\" href='" + page.link + "'>Go to Resource</a><a class=\"button is-dark my-2\" href=\"" + page.permalink + "\">More Details</a><p style='margin-top: 5px'>" + tagsHTML + "</p></li>";
                                    results.insertAdjacentHTML("beforeend",resultHTML);
            
                                    if (display_score == true) {
                                        results.insertAdjacentHTML("beforeend","<p>Result score: " + page.score + "</p>")
                                    };
            
                                }); 
            
                            }; 
                            
                        }); 
                    });
            </script>
        </div>
    </div>
        
        
  </body>
</html>