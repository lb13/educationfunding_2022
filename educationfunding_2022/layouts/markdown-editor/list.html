{{ define "main" }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        height: 100vh;
        display: flex;
        flex-direction: column;
        background: #f5f5f5;
    }
    
    .header {
        background: #2d3748;
        color: white;
        padding: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .header h1 {
        font-size: 1.5rem;
        font-weight: 600;
    }
    
    .view-toggle {
        display: flex;
        background: #4a5568;
        border-radius: 6px;
        overflow: hidden;
    }
    
    .toggle-btn {
        padding: 0.5rem 1rem;
        background: transparent;
        border: none;
        color: white;
        cursor: pointer;
        transition: background-color 0.2s;
        font-size: 0.875rem;
    }
    
    .toggle-btn:hover {
        background: #718096;
    }
    
    .toggle-btn.active {
        background: #667eea;
    }
    
    .editor-container {
        display: flex;
        flex: 1;
        gap: 1px;
        background: #e2e8f0;
    }
    
    .editor-panel, .preview-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: white;
    }
    
    .panel-header {
        background: #edf2f7;
        padding: 0.75rem 1rem;
        border-bottom: 1px solid #e2e8f0;
        font-weight: 600;
        color: #4a5568;
        font-size: 0.875rem;
    }
    
    .editor {
        flex: 1;
        border: none;
        outline: none;
        padding: 1rem;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 14px;
        line-height: 1.5;
        resize: none;
        background: #fafafa;
    }
    
    .preview {
        flex: 1;
        padding: 1rem;
        overflow-y: auto;
        background: white;
    }
    
    .preview h1, .preview h2, .preview h3, .preview h4, .preview h5, .preview h6 {
        margin: 1rem 0 0.5rem;
        color: #2d3748;
    }
    
    .preview h1 { font-size: 2rem; border-bottom: 2px solid #e2e8f0; padding-bottom: 0.5rem; }
    .preview h2 { font-size: 1.5rem; }
    .preview h3 { font-size: 1.25rem; }
    
    .preview p {
        margin: 0.5rem 0;
        line-height: 1.6;
        color: #4a5568;
    }
    
    .preview ul, .preview ol {
        margin: 0.5rem 0 0.5rem 2rem;
    }
    
    .preview li {
        margin: 0.25rem 0;
        line-height: 1.5;
    }
    
    .preview blockquote {
        border-left: 4px solid #667eea;
        margin: 1rem 0;
        padding: 0.5rem 1rem;
        background: #f7fafc;
        color: #4a5568;
        font-style: italic;
    }
    
    .preview code {
        background: #edf2f7;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.875rem;
        color: #e53e3e;
    }
    
    .preview pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 1rem;
        border-radius: 6px;
        overflow-x: auto;
        margin: 1rem 0;
    }
    
    .preview pre code {
        background: none;
        color: inherit;
        padding: 0;
    }
    
    .preview table {
        border-collapse: collapse;
        width: 100%;
        margin: 1rem 0;
    }
    
    .preview th, .preview td {
        border: 1px solid #e2e8f0;
        padding: 0.5rem;
        text-align: left;
    }
    
    .preview th {
        background: #edf2f7;
        font-weight: 600;
    }
    
    .preview a {
        color: #667eea;
        text-decoration: none;
    }
    
    .preview a:hover {
        text-decoration: underline;
    }
    
    .html-preview {
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 13px;
        line-height: 1.4;
        color: #2d3748;
        white-space: pre-wrap;
        background: #f7fafc;
    }
    
    @media (max-width: 768px) {
        .editor-container {
            flex-direction: column;
        }
        
        .header {
            flex-direction: column;
            gap: 1rem;
            text-align: center;
        }
    }
</style>
        
        <div class="header">
        <h1>Markdown Editor</h1>
        <div class="view-toggle">
            <button class="toggle-btn active" data-view="rich">Rich Text</button>
            <button class="toggle-btn" data-view="html">HTML Source</button>
        </div>
    </div>
    
    <div class="editor-container">
        <div class="editor-panel">
            <div class="panel-header">Markdown Input</div>
            <textarea class="editor" placeholder="Type your markdown here...
 
# Welcome to Markdown Editor
 
This is a **live preview** markdown editor. Try writing some markdown:
 
## Features
- Real-time preview
- Switch between rich text and HTML view
- Clean, responsive design
 
### Code Example
```javascript
function hello() {
    console.log('Hello, World!');
}
```
 
> This is a blockquote. You can use it for emphasis.
 
| Feature | Status |
|---------|--------|
| Live Preview | ? |
| HTML View | ? |
| Mobile Friendly | ? |"></textarea>
        </div>
        
        <div class="preview-panel">
            <div class="panel-header">Preview</div>
            <div class="preview" id="preview"></div>
        </div>
    </div>
           
 
<script>
   const editor = document.querySelector('.editor');
        const preview = document.getElementById('preview');
        const toggleBtns = document.querySelectorAll('.toggle-btn');
        
        let currentView = 'rich';
        
        // Configure marked options
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: false,
            sanitize: false,
            mangle: false  // Disable email address encoding
        });
        
        function updatePreview() {
            const markdown = editor.value;
            const html = marked.parse(markdown);
            
            if (currentView === 'rich') {
                preview.innerHTML = html;
                preview.className = 'preview';
            } else {
                preview.textContent = html;
                preview.className = 'preview html-preview';
            }
        }
        
        function switchView(view) {
            currentView = view;
            
            // Update button states
            toggleBtns.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === view);
            });
            
            // Update preview
            updatePreview();
        }
        
        // Event listeners
        editor.addEventListener('input', updatePreview);
        editor.addEventListener('scroll', () => {
            // Sync scroll position (optional enhancement)
            const scrollPercent = editor.scrollTop / (editor.scrollHeight - editor.clientHeight);
            preview.scrollTop = scrollPercent * (preview.scrollHeight - preview.clientHeight);
        });
        
        toggleBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                switchView(btn.dataset.view);
            });
        });
        
        // Initialize with default content
        updatePreview();
        
        // Keyboard shortcuts
        editor.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 'b':
                        e.preventDefault();
                        insertMarkdown('**', '**');
                        break;
                    case 'i':
                        e.preventDefault();
                        insertMarkdown('*', '*');
                        break;
                    case 'k':
                        e.preventDefault();
                        insertMarkdown('[', '](url)');
                        break;
                }
            }
            
            // Tab handling for indentation
            if (e.key === 'Tab') {
                e.preventDefault();
                const start = editor.selectionStart;
                const end = editor.selectionEnd;
                editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
                editor.selectionStart = editor.selectionEnd = start + 4;
                updatePreview();
            }
        });
        
        function insertMarkdown(before, after) {
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            const selected = editor.value.substring(start, end);
            const replacement = before + selected + after;
            
            editor.value = editor.value.substring(0, start) + replacement + editor.value.substring(end);
            editor.selectionStart = start + before.length;
            editor.selectionEnd = start + before.length + selected.length;
            editor.focus();
            updatePreview();
        }
</script>
{{ end }}