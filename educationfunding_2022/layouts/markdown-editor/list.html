{{ define "main" }}
<div class="container">
    <div class="container is-fluid">
    <!-- Markdown Editor - Embeddable Version -->
<div id="markdown-editor-container">
    <div class="md-editor-header">
        <h2 class="md-editor-title">Markdown Editor</h2>
        <div class="md-view-toggle">
            <button class="md-toggle-btn md-toggle-active" data-view="rich">Rich Text</button>
            <button class="md-toggle-btn" data-view="html">HTML Source</button>
        </div>
    </div>
    
    <div class="md-editor-container">
        <div class="md-editor-panel">
            <div class="md-panel-header">Markdown Input</div>
            <textarea class="md-editor" placeholder="Type your markdown here...
 
# Welcome to Markdown Editor
 
This is a **live preview** markdown editor. Try writing some markdown:
 
## Features
- Real-time preview
- Switch between rich text and HTML view
- Clean, responsive design
 
### Code Example
```javascript
function hello() {
    console.log('Hello, World!');
}
```
 
> This is a blockquote. You can use it for emphasis.
 
| Feature | Status |
|---------|--------|
| Live Preview | ? |
| HTML View | ? |
| Mobile Friendly | ? |"></textarea>
        </div>
        
        <div class="md-preview-panel">
            <div class="md-panel-header">Preview</div>
            <div class="md-preview" id="md-preview"></div>
        </div>
    </div>
</div>
 
<style>
#markdown-editor-container {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    height: 600px;
    display: flex;
    flex-direction: column;
    background: #f5f5f5;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
    margin: 1rem 0;
}
 
#markdown-editor-container * {
    box-sizing: border-box;
}
 
#markdown-editor-container .md-editor-header {
    background: #2d3748;
    color: white;
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    flex-shrink: 0;
}
 
#markdown-editor-container .md-editor-title {
    font-size: 1.25rem;
    font-weight: 600;
    margin: 0;
    color: white;
}
 
#markdown-editor-container .md-view-toggle {
    display: flex;
    background: #4a5568;
    border-radius: 6px;
    overflow: hidden;
}
 
#markdown-editor-container .md-toggle-btn {
    padding: 0.5rem 1rem;
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    transition: background-color 0.2s;
    font-size: 0.875rem;
    font-family: inherit;
}
 
#markdown-editor-container .md-toggle-btn:hover {
    background: #718096;
}
 
#markdown-editor-container .md-toggle-btn.md-toggle-active {
    background: #667eea;
}
 
#markdown-editor-container .md-editor-container {
    display: flex;
    flex: 1;
    gap: 1px;
    background: #e2e8f0;
    min-height: 0;
}
 
#markdown-editor-container .md-editor-panel, 
#markdown-editor-container .md-preview-panel {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: white;
    min-width: 0;
}
 
#markdown-editor-container .md-panel-header {
    background: #edf2f7;
    padding: 0.75rem 1rem;
    border-bottom: 1px solid #e2e8f0;
    font-weight: 600;
    color: #4a5568;
    font-size: 0.875rem;
    flex-shrink: 0;
}
 
#markdown-editor-container .md-editor {
    flex: 1;
    border: none;
    outline: none;
    padding: 1rem;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 14px;
    line-height: 1.5;
    resize: none;
    background: #fafafa;
    margin: 0;
}
 
#markdown-editor-container .md-preview {
    flex: 1;
    padding: 1rem;
    overflow-y: auto;
    background: white;
}
 
#markdown-editor-container .md-preview h1, 
#markdown-editor-container .md-preview h2, 
#markdown-editor-container .md-preview h3, 
#markdown-editor-container .md-preview h4, 
#markdown-editor-container .md-preview h5, 
#markdown-editor-container .md-preview h6 {
    margin: 1rem 0 0.5rem;
    color: #2d3748;
}
 
#markdown-editor-container .md-preview h1 { 
    font-size: 2rem; 
    border-bottom: 2px solid #e2e8f0; 
    padding-bottom: 0.5rem; 
}
#markdown-editor-container .md-preview h2 { font-size: 1.5rem; }
#markdown-editor-container .md-preview h3 { font-size: 1.25rem; }
 
#markdown-editor-container .md-preview p {
    margin: 0.5rem 0;
    line-height: 1.6;
    color: #4a5568;
}
 
#markdown-editor-container .md-preview ul, 
#markdown-editor-container .md-preview ol {
    margin: 0.5rem 0 0.5rem 2rem;
}
 
#markdown-editor-container .md-preview li {
    margin: 0.25rem 0;
    line-height: 1.5;
}
 
#markdown-editor-container .md-preview blockquote {
    border-left: 4px solid #667eea;
    margin: 1rem 0;
    padding: 0.5rem 1rem;
    background: #f7fafc;
    color: #4a5568;
    font-style: italic;
}
 
#markdown-editor-container .md-preview code {
    background: #edf2f7;
    padding: 0.2rem 0.4rem;
    border-radius: 3px;
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    font-size: 0.875rem;
    color: #e53e3e;
}
 
#markdown-editor-container .md-preview pre {
    background: #2d3748;
    color: #e2e8f0;
    padding: 1rem;
    border-radius: 6px;
    overflow-x: auto;
    margin: 1rem 0;
}
 
#markdown-editor-container .md-preview pre code {
    background: none;
    color: inherit;
    padding: 0;
}
 
#markdown-editor-container .md-preview table {
    border-collapse: collapse;
    width: 100%;
    margin: 1rem 0;
}
 
#markdown-editor-container .md-preview th, 
#markdown-editor-container .md-preview td {
    border: 1px solid #e2e8f0;
    padding: 0.5rem;
    text-align: left;
}
 
#markdown-editor-container .md-preview th {
    background: #edf2f7;
    font-weight: 600;
}
 
#markdown-editor-container .md-preview a {
    color: #667eea;
    text-decoration: none;
}
 
#markdown-editor-container .md-preview a:hover {
    text-decoration: underline;
}
 
#markdown-editor-container .md-html-preview {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace !important;
    font-size: 13px !important;
    line-height: 1.4 !important;
    color: #2d3748 !important;
    white-space: pre-wrap !important;
    background: #f7fafc !important;
}
 
@media (max-width: 768px) {
    #markdown-editor-container .md-editor-container {
        flex-direction: column;
    }
    
    #markdown-editor-container .md-editor-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    #markdown-editor-container {
        height: 800px;
    }
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
<script>
(function() {
    const container = document.getElementById('markdown-editor-container');
    const editor = container.querySelector('.md-editor');
    const preview = container.querySelector('#md-preview');
    const toggleBtns = container.querySelectorAll('.md-toggle-btn');
    
    let currentView = 'rich';
    
    // Configure marked options
    marked.setOptions({
        breaks: true,
        gfm: true,
        headerIds: false,
        sanitize: false,
        mangle: false  // Disable email address encoding
    });
    
    function updatePreview() {
        const markdown = editor.value;
        const html = marked.parse(markdown);
        
        if (currentView === 'rich') {
            preview.innerHTML = html;
            preview.className = 'md-preview';
        } else {
            preview.textContent = html;
            preview.className = 'md-preview md-html-preview';
        }
    }
    
    function switchView(view) {
        currentView = view;
        
        // Update button states
        toggleBtns.forEach(btn => {
            btn.classList.toggle('md-toggle-active', btn.dataset.view === view);
        });
        
        // Update preview
        updatePreview();
    }
    
    // Event listeners
    editor.addEventListener('input', updatePreview);
    editor.addEventListener('scroll', () => {
        // Sync scroll position
        const scrollPercent = editor.scrollTop / (editor.scrollHeight - editor.clientHeight);
        preview.scrollTop = scrollPercent * (preview.scrollHeight - preview.clientHeight);
    });
    
    toggleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            switchView(btn.dataset.view);
        });
    });
    
    // Initialize with default content
    updatePreview();
    
    // Keyboard shortcuts
    editor.addEventListener('keydown', (e) => {
        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'b':
                    e.preventDefault();
                    insertMarkdown('**', '**');
                    break;
                case 'i':
                    e.preventDefault();
                    insertMarkdown('*', '*');
                    break;
                case 'k':
                    e.preventDefault();
                    insertMarkdown('[', '](url)');
                    break;
            }
        }
        
        // Tab handling for indentation
        if (e.key === 'Tab') {
            e.preventDefault();
            const start = editor.selectionStart;
            const end = editor.selectionEnd;
            editor.value = editor.value.substring(0, start) + '    ' + editor.value.substring(end);
            editor.selectionStart = editor.selectionEnd = start + 4;
            updatePreview();
        }
    });
    
    function insertMarkdown(before, after) {
        const start = editor.selectionStart;
        const end = editor.selectionEnd;
        const selected = editor.value.substring(start, end);
        const replacement = before + selected + after;
        
        editor.value = editor.value.substring(0, start) + replacement + editor.value.substring(end);
        editor.selectionStart = start + before.length;
        editor.selectionEnd = start + before.length + selected.length;
        editor.focus();
        updatePreview();
    }
})();
</script>
    </div>
</div>
{{ end }}